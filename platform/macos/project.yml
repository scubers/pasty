name: Pasty

options:
  bundleIdPrefix: com.pasty
  createIntermediateGroups: true
  deploymentTarget:
    macOS: "14.0"
  xcodeVersion: "16.2"
  minimumXcodeVersion: "16.2"

packages:
  KeyboardShortcuts:
    url: https://github.com/sindresorhus/KeyboardShortcuts
    from: "2.0.0"
  SnapKit:
    url: https://github.com/SnapKit/SnapKit
    from: "5.0.0"
  CocoaLumberjack:
    url: https://github.com/CocoaLumberjack/CocoaLumberjack.git
    from: "3.8.0"

settings:
  base:
    CLANG_CXX_LANGUAGE_STANDARD: c++17
    CLANG_CXX_LIBRARY: libc++
    MACOSX_DEPLOYMENT_TARGET: "14.0"
    SWIFT_VERSION: "5.9"

targets:
  PastyCore:
    type: library.static
    platform: macOS
    sources:
      - path: ../../core/src/Pasty.cpp
        compilerFlags:
          - -Wall
      - path: ../../core/src/history
        compilerFlags:
          - -Wall
      - path: ../../core/src/settings
        compilerFlags:
          - -Wall
      - path: ../../core/src/logger.cpp
        compilerFlags:
          - -Wall
      - path: ../../core/include/pasty
        buildPhase: headers
        headerVisibility: public
    settings:
      HEADER_SEARCH_PATHS:
        - $(SRCROOT)/../../core/include
      PRODUCT_NAME: PastyCore
      SKIP_INSTALL: YES
      DEFINES_MODULE: YES
      MODULEMAP_FILE: $(SRCROOT)/../../core/include/module.modulemap
    dependencies:
      - sdk: libsqlite3.tbd

  Pasty:
    type: application
    platform: macOS
    sources:
      - path: Sources
      - path: Info.plist
        buildPhase: none
      - path: Resources/Assets.xcassets
      - path: ../../core/migrations
        buildPhase: resources
        type: folder
    settings:
      INFOPLIST_FILE: Info.plist
      PRODUCT_BUNDLE_IDENTIFIER: com.pasty.app
      PRODUCT_NAME: Pasty
      CODE_SIGN_IDENTITY: "-"
      CODE_SIGNING_REQUIRED: NO
      ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
      SWIFT_OBJC_INTEROP_MODE: objcxx
      SWIFT_EMIT_LOC_STRINGS: NO
      OTHER_SWIFT_FLAGS:
        - -cxx-interoperability-mode=default
      HEADER_SEARCH_PATHS:
        - $(SRCROOT)/../../core/include
      SWIFT_INCLUDE_PATHS:
        - $(SRCROOT)/../../core/include
    dependencies:
      - target: PastyCore
      - sdk: Cocoa.framework
      - sdk: libsqlite3.tbd
      - package: KeyboardShortcuts
      - package: SnapKit
      - package: CocoaLumberjack
        product: CocoaLumberjackSwift
